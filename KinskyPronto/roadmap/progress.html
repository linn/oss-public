<html>
<head>
<title>Kinsky Pronto Progress Reports</title>
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>
<link rel="shortcut icon" href="http://www.rikwatson.com/favicon.ico" type="image/x-icon" />
<link rel="icon" href="http://www.rikwatson.com/favicon.ico" type="image/x-icon" />
<style type="text/css" media="screen">@import "_css/header.css";</style>
<style type="text/css">
<!--
body {

  margin: 0;
  font-family: "Tahoma";	
	
    overflow-x: hidden;
    -webkit-user-select: none;
    -webkit-text-size-adjust: none;
    
}

.unimplemented {
	COLOR: #999
}

.bug {
	COLOR: red
}

.heading {
  line-height: 0.75em;
  margin: 0px 0px 0px 0px;
  padding: 0px 0px 0px 0px;
  text-align: center;
  font-weight: bold;
  background-color:  #416779; /* #408080; */
  font-size:400%;
  color:white;
}

.content {
  margin: 5px 5px 5px 5px;
  padding: 5px 5px 5px 5px;
}

-->
</style>


<script type="text/javascript">
function loaded(){

   window.scrollTo(0,1);
};
</script>

</head>
<body onload="loaded()">

<div class="heading">
<br/>Kinsky Pronto Roadmap
</div>

<div class="content">


<h1>
Kinsky Pronto Progress Against Plan
</h1>

<h2>Overview</h2>
<p>
This document outlines the new functionality being added to the next release of Kinsky Pronto &amp; the progress
against that plan. In summary all graphics changes (Except startup selection splash screen) are in place, though in some cases
the is no 'engine' driving them. 
</p>

<h2>Summary</h2>
  <table border="1">
    <thead>
    <tr bgcolor=silver><td>Title</td><td>Completed</td><td>Total</td><td>Due date</td><td>&nbsp;</td></tr>
    </thead>
    <tbody>
    <tfoot>
    <tr><td>Total</td><td>13</td><td>24</td><td></td><td></td></tr>
    </tfoot>
    <tr><td>UTF-8 font support (investigate)</td><td>1  </td><td>1  </td><td>Completed</td><td>&nbsp;</td></tr>
    <tr><td>Speedup (XML/E4X) Investigate   </td><td>2  </td><td>2  </td><td>Completed</td><td>&nbsp;</td></tr>
    <tr><td>Title Bar                       </td><td>0.5</td><td>1  </td><td><b>19-Aug-2010</b></td><td>&nbsp;</td></tr>
    <tr><td>Radio Preset Hi-lite            </td><td>0.5</td><td>1  </td><td>23-Aug-2010</td><td></td></tr>
    <tr><td>Delayed Start                   </td><td>6  </td><td>7  </td><td>13-Sep-2010</td><td></td></tr>
    <tr><td>UTF-8 font support (implement)  </td><td>0  </td><td>2  </td><td>17-Sep-2010</td><td></td></tr>
    <tr><td>Font Size                       </td><td>-  </td><td>-  </td><td>   - " -   </td><td>note</td></tr>
    <tr><td>Long List handling              </td><td>3  </td><td>10 </td><td>15-Oct-2010</td><td>note</td></tr>
    <tr><td>E4X Implement                   </td><td>TBD</td><td>TBD</td><td>  TBD      </td><td>Under review</td></tr>
    <tbody>
  </table>



<h2>Overall</h2>
<p>
Progress is on schedule - however some tasks have slipped as work has (necessarily) started
on later task early. Invoices 523 &amp; 524 have been raised for 10 days work.
</p>

<h2>UTF-8 font support (investigate)</h2>

<p>Investigation into UTF-8 font support is complete. Test application provided to Linn to allow selection of font &amp; size.
It looks like the Droid Sans at 14pt or larger is acceptable.
Note that the Droid font's don't have eastern character sets, however should we find a more suitable font then we will be able to
change as the font will be easily editable in source [A single string constant will hold the font's name.]
</p>



<h2>Speedup (XML/E4X) Investigate</h2>

<p>
In initial investigation has been completed. In summary: the use of E4X may be of use for future XML parsing however it's use
for parsing large chunks of XML within the Pronto is limited because of the large in-memory footprint of the resulting XML objects.
Also there is some concern about being able to revert to the original text string for returning DIDL objects without loosing data.
[Ie. The media server returns a track with a 'composer' tag - we would ignore this &amp; not pass the tag to the DS's playlist.
This would imply that other control points which could make use of this tag would not <em>see</em> it].
</p>

<h2>UI Improvements (Title Bar)</h2>

<p>
Initial code to create graphics on-the-fly in place and just needs integration into the back end engine.
I've also used this as an opportunity to investigate dynamic GUI objects (a new Pronto feature) as these
will be necessary for any touchscreen feature we would like to add later. All graphics elements been changed and the
graphics for <em>large</em> volume slider / triangle have been added to the Pronto project (But currently not used).
</p>
<p>
<b>Note:</b> Currently showing as slip on timescales as I've spent time on 'Long List Handling' and Radio
Preset Hi-lite (See below). Should complete 2010-Aug-26.
</p>

<h2>Radio Preset Hi-lite</h2>
<p>
All graphics &amp; UI changes made.
</p>
<p>
<b>Note:</b> Currently showing as slip on timescales as I've spent time on 'Long List Handling' and this
will change similar code (Need to move Radio from using <em>scrollWheelManagement</em> to
<em>scrollWheelManagementLowLevel</em>. I am considering slipping this further but bringing forward
some of the backend work on 'Long List Handling' as this will stop me having to re-code my new code twice.
</p>

<h2>Speedup (Delayed Start)</h2>

<p>
Some changes to <em>elab</em> already made these have resulted in the Pronto activity screen being displayed
in approx 2 seconds. Existing (ineffective) splash screens have been removed from the project.
New startup splash screen has been added.\
Various startup code changes have been made to tasks to reduce startup times further. Splash screen now display
immediately with normal screen visible after about 3.5 seconds. Pronto is fully usable about 5 seconds after that.
[Note: These times are with full debug enabled actual times will be reduces.]
Future work will:

<ul>
<li>Contine <em>elab</em> work</li>
<li>Move individual packages to a delayed start.</li>
</ul>
</p>


<h2>UTF-8 font support (implement)</h2>
<p>
No progres to date. Note that the choice of font can be defered as the UI will be modified to allow
the font used to be specified as a string (Not a user / installer option, but a string constant in the code).
</p>


<h2>Font Size</h2>
<p>
This is a no-cost activity which will be included as part of the UTF-8 work. Only shown here for completeness.
</p>

<h2>Long List handling (Radio &amp; Library)</h2>
<p>
Some initial investigation and design work has started - pertaing to the changes needed to replace
the <em>scrollWheelManagement</em> packages (See Radio UI highlight work). Initial caching code completed &amp; work on
'ScrollWheelManagement' started. With luck these changes will flow natually into the forthcomming 'Touch' UI.
</p>

<h2>Speedup (XML/E4X) Implement</h2>
<h3>[0 : 0 : 0]<br/>
    2010-mm-dd</h3>
<p>
Effort still TBD, will quote separatly - probably 5-7 days. My current guess is that that timescaled will be
less but that we will only use E4X for very small time critial aspects.
</p>

<!--
<p>
If you have a feature which you would like to see in Kinsky Pronto which is not listed here then please email
<a href="mailto:rik@plancd.com">us</a>.
</p>
<h2>V3.2.1</h2>
<p>
This is current shipping release of Kinsky Pronto. And features not in this release with be in <span class=unimplemented>grey</span>,
any know bugs will be in <span class=bug>red</span>.
</p>

<p>
Features have been split into internal, under-the-hood changes, and UI enhancements
</p>

<h2>Internal</h2>
<ul>
<li class=bug>Recovery from power save often fails to reconnect cleanly<br>
(GD has done some investigation and knows what to do to fix this using the new Pronto events)</li>
<li class=unimplemented>Sort XML Processing Out</li>
<li class=unimplemented>Better startup processing for IP checking etc<br/>
Should make use of the Pronto's new ability to create alert boxes to let the end user know that we can't contact DS / Media Server.
</li>
<li class=unimplemented>Rewrite Media Server access<br/>
Although this started out as nice MVC modules, it isn't now. We need to abscract out the functionality we need from the media server.
This would help with some of the proposed UI changes outlines below.
</li>
<li class=unimplemented>Merge Konductor's Playlist code<br/>
Konductor has a much better absctracted view of the Playlist, although we couldn't do a straight code replacement we
could use it's ideas (Albums or tracks etc).
</li>
<li class=unimplemented>SSDP / UDP<br/>
Do we want to add this? I'm thinking now but the Pronto does now support UDP sockets so it's a possibility.<br>
Don't think so - Pronto is heavily tied to single room due to its 'Activities' concept, and the startup time which this would add to the individual apps (Playlist, Radio, Playlist, Embedded) would be unacceptable</li>
</ul>
<li class=unimplemented>Mute toggle (rather than mute on) in linnControl - reqs subscriptions as done for lipsync</li>
<li class=unimplemented>More speedups - notable are is playlist page</li>

<h2>UI</h2>
<ul>
<li class=bug>Better Support for UTF-8 Characters (e.g. Björk, not Bj__rk)</li>
<li class=bug>Allow for lists longer than 250 entries (either internally page this, or reduce amount of data stored in memory to minimum reqd - as using DIDL suspect may be large savings here which would permit lists of several thousand entries)</li>
<li class=bug>Extra blank page displayed for lists when number of entries in list exact multiple of page length</li>
<li class=unimplemented>Scroll Wheel - enough said</li>
<li class=unimplemented>Library browsing - up level should return to last viewed entry, not start of list</li>
<li class=unimplemented>Improved top line 'status bar'</br>
This is 60px high &amp; doesn't hold much of interest, we could put current track, play state, album art &amp; volume into the space
quite easily (at least on the 9600, would need to be selective on the 9400). Much more useful than the data &amp; time!
<img src="Status Bar.png"><br/>
For the 9400 I've moved the toolbox 'cog' to the bottom (Not sure we even need it) &amp; the cover
art overflows into to list view - which shouldn't be a problem as I can make the layers above transparent.<br/>
<img src="9400 status bar top.png"><br/>&nbsp;<br/>
<img src="9400 status bar bottom.png">
</li>
<li class=unimplemented>Improved Media Server (Library) view</br>
Should have different views depending on if we are looking at an album or not.
</li>
<li class=unimplemented>Album Art in library view - could work if we only show 4-6 covers at a time &amp; implement so default image
prior to showing graphics to reduce network bandwith when scrolling through lots of albums (see Squeezebox Duet controller for example of how to handle this).</li>
<li class=unimplemented>Album Art in Playlist view - need to be combined with track to album merging below.</li>
<li class=unimplemented>Track to album merging - thinking Konductor here. One view would show all the albums, when you select the album you get to see the
tracks (With album summary at the top).</li>
<li class=unimplemented>Splash screens for individual apps to mask initial loading time</li>
<li class=unimplemented>Preamp only - big volume bar in middle of display</li>
<li class=unimplemented>Add 'buffering' display when state is buffering (on stop/play icon ?)</li>
<li class=unimplemented>Radio channels list - spkr icon beside currently selected</li>
<li class=unimplemented>Display cover art in info space at base of playlist page</li>
<li class=unimplemented>Selection of radio station using touch-screen icon<li>
<li class=unimplemented>Selection of album/artist etc. using touch-screen icon<li>
<li class=unimplemented>&hellip;</li>
<li class=unimplemented>Different font - speak to JoshH.</li>
<li class=unimplemented>Smaller or non-bold fonts in list</li>
<li class=unimplemented>Use of scroll wheel, line at a time?</li>
</ul>



</div> 

<pre>
Common Header for all pages.

E4X

Put roadmap HTML on svn site. 
 
activity.js have a timer every 10th second for 5 seconds to show activity. 

Have a delta time if > 5 sec from base then hide but if we create dynamically so what about deletion and multiple instances? Could always just extend the timer adhausium. 

Progress indicator over Settings.png cog. 

Philips Pronto TSW9500 - In Wall Pronto

Usage Video http://www.youtube.com/watch?v=b9Laduo_9Oc
</pre>

<h2>Control of Systems</h2>
Where Pronto is used with Linn (or 3rd party) preamp it makes more sense to offer full control of the preamp from the device, rather than just proxied volume and source switching controls. This would eliminate need for other controller for preamp, which is what integrated solutions is all about. Hence development of RS232 drivers for Linn equipment should be prioritised



<h2>Code Notes</h2>

<p>
What we MUST understand is that in the Pronto Operating system, a real socket is mapped into the javascript space. When you set a javascript socket reference to null,
that only frees the javascript object and makes it available for garbage collection.
It does NOT automatically close the socket.
The same thing occurs whenever you assign a new TCPSocket() to a variable. The old javascript representation of the real socket object is now eligible for garbage collection but the back-end socket is still open. 
</p>
<p>

Therefore, to make all this work, you MUST figure out from the data stream when you can be done with a socket and then issue a close() call. To make things a bit easier, you can also reference the 'connected' member field to see if a close is really needed.
</p>
<p>

For example:
</p>

<pre>
if (socket && socket.connected) {
  try {
    socket.close();
  } catch (e) {
    Diagnostics.log('close error! e: ' + e);
  } finally {
    socket = null;
  };
};
</pre>

<h3>How to automatically reconnect after onTimeout/onError/onClose?</h3>
<p>

Using the onTimeout, onError and onClose callback functions it is always possible to re-send the command if the first time failed. 
These callback functions will typically try to reestablish the conection whereafter the onConnect callback will resend the command.
</p>
<p>
e.g.:
</p>
<pre>

function reInitSocket() {
   socket = new TCPSocket();
   socket.onConnect = onConnect;
   socket.onData = onData;
   socket.onClose = onClose;
   socket.onIOError = onIOError;
   socket.connect(IPAddress, Port, Timeout);
};

function onTimeout(){
   reInitSocket();
};
</pre>


<h3>Can I reconnect to an existing socket?</h3>
<p>
The answer is no.
</p>
<p>
Reusing a TCPSocket is not implemented. Always create a new socket after a close:
</p>

<pre>
function reInitSocket() {
   socket = new TCPSocket();
   socket.onConnect = onConnect;
   socket.onData = onData;
   socket.onClose = onClose;
   socket.onIOError = onIOError;
   socket.connect(IPAddress, Port);
};

.....

if (socket.connected === true){
   socket.write(...
} else {
   reInitSocket();
};
</pre>

<h3>Graphics on the fly</h3>
<p>
Along the lines of:
</p>
<pre>
var w;
w = GUI.addButton();
w.setColor(0x000000, 0); /* Black */
w.setBgColor(0x701919, 0); /* Midnight Blue */
w.setColor(0x000000, 1); /* Black */
w.setBgColor(0x00a5ff, 1); /* Orange */
w.left = 10;
w.top = 100;
w.width = 80;
w.height = 30;
w.fontSize = 20;
w.label = "Go!";
w.visible = true;

....

w.remove();

...

To be added to activity.js

Set a timer & remove after 5 seconds.
</pre>

-->

</body>
</html>